#!/usr/bin/env bash
# 1. Install your load balancer
apt-get install --no-install-recommends software-properties-common
add-apt-repository ppa:vbernat/haproxy-2.0
apt-get install haproxy=2.0.\*
file="/etc/haproxy/haproxy.cfg"
echo -e "frontend my_frontend" >> "$file"
echo -e "\tbind *:80" >> "$file"
echo -e "\tdefault_backend my_backend" >> "$file"
echo -e "backend my_backend" >> "$file"
echo -e "\tbalance roundrobin" >> "$file"
echo -e "\tserver 380698-web-01 100.25.152.12:80 check" >> "$file"
echo -e "\tserver 380698-web-02 54.167.85.211:80 check" >> "$file"
echo "ENABLED=1" >> /etc/default/haproxy
systemctl restart haproxy
